<p>So the assignment is to create the blackjack game. The <a href="http://en.wikipedia.org/wiki/Blackjack#Rules_of_play_at_casinos">rules</a> of BlackJack. </p>

<p>Blank page ready I started off by writing some pseudo code for the high level principles of the game. Already I cannot imagine starting to write a program without this as it really gets you into the zone of thinking about how your program is going to operate without cluttering my mind worrying about the actual code.</p>

<p>My high-level pseudo code:</p>

<div class="highlight"><pre><code class="ruby"><span class="c1"># Initialize deck of cards</span>
  <span class="c1"># Deal two random cards each to player(s) and dealer</span>
    <span class="c1"># Player &#39;Hits&#39; or &#39;Stays&#39; or has BJ</span>
      <span class="c1"># continue until &#39;Stay&#39; or &#39;Bust&#39;</span>
        <span class="c1"># Dealer plays </span>
          <span class="c1"># Result </span>
            <span class="c1"># play again?</span></code></pre></div>

<p>Once I’d written this foundation I went into a second level of detail to better understand each step fully and ended up with this:</p>

<div class="highlight"><pre><code class="ruby"><span class="c1"># Initialize deck of cards</span>
  <span class="c1"># Deal two random cards each to player(s) and dealer</span>
  <span class="c1"># Remove the dealt cards from the deck as they are dealt</span>
    <span class="c1"># Player &#39;Hits&#39; or &#39;Stays&#39; or has BJ</span>
      <span class="c1"># if player has BJ play moves to Dealer</span>
      <span class="c1"># if player hits then another card is dealt</span>
      <span class="c1"># if total exceeds 21 player busts comp wins, else if player has &gt; 16 &amp;&amp; &lt; 20 player can &#39;Hit&#39; or &#39;Stay&#39;, else &#39;Hit&#39; </span>
      <span class="c1"># Remove dealt cards from deck array</span>
      <span class="c1"># continue until &#39;Stay&#39; or &#39;Bust&#39;</span>
        <span class="c1"># Dealer plays if Player &#39;Stayed&#39; or has BJ</span>
          <span class="c1"># if dealer cards == BJ &amp;&amp; players cards == BJ its a draw</span>
          <span class="c1"># else if dealers cards &lt; 16 dealer &#39;Hits&#39;</span>
          <span class="c1"># else if dealers cards &gt; 16 &amp;&amp; &lt; 19 random (&#39;Hit&#39; or &#39;Stay&#39;)</span>
          <span class="c1"># else if dealers cards &gt;= 19 &amp;&amp; &lt;= 21 &#39;Stay&#39;</span>
          <span class="c1"># else bust </span>
            <span class="c1"># Result compares </span>
              <span class="c1"># play again?</span></code></pre></div>

<p>With the logic written I dived into writing the methods I’ll need for my program to operate. I figured I needed a method that calculates the running total of the players cards, a method for each of the players for hitting or staying, a hit method that adds a new card to the players hand. A few potential tricky elements began to enter my head such as how I’m going to handle the Aces that can be worth 1 or 11. Some thinking time is needed. Anyway this is what I have so far:</p>

<div class="highlight"><pre><code class="ruby"><span class="lineno"> 1</span> <span class="c1"># multidimensional array holding two identical decks. Two decks to prevent card counting.</span>
<span class="lineno"> 2</span> <span class="n">decks</span> <span class="o">=</span> <span class="o">[</span>
<span class="lineno"> 3</span>   <span class="o">[</span><span class="s1">&#39;Ah &#39;</span><span class="p">,</span> <span class="s1">&#39;2h &#39;</span><span class="p">,</span> <span class="s1">&#39;3h &#39;</span><span class="p">,</span> <span class="s1">&#39;4h &#39;</span><span class="p">,</span> <span class="s1">&#39;5h &#39;</span><span class="p">,</span> <span class="s1">&#39;6h &#39;</span><span class="p">,</span> <span class="s1">&#39;7h &#39;</span><span class="p">,</span> <span class="s1">&#39;8h &#39;</span><span class="p">,</span> <span class="s1">&#39;9h &#39;</span><span class="p">,</span> <span class="s1">&#39;10h&#39;</span><span class="p">,</span> <span class="s1">&#39;Jh &#39;</span><span class="p">,</span> <span class="s1">&#39;Qh &#39;</span><span class="p">,</span> <span class="s1">&#39;Kh &#39;</span><span class="p">,</span><span class="s1">&#39;Ad &#39;</span><span class="p">,</span> <span class="s1">&#39;2d &#39;</span><span class="p">,</span> <span class="s1">&#39;3d &#39;</span><span class="p">,</span> <span class="s1">&#39;4d &#39;</span><span class="p">,</span> <span class="s1">&#39;5d &#39;</span><span class="p">,</span> <span class="s1">&#39;6d &#39;</span><span class="p">,</span> <span class="s1">&#39;7d &#39;</span><span class="p">,</span> <span class="s1">&#39;8d &#39;</span><span class="p">,</span> <span class="s1">&#39;9d &#39;</span><span class="p">,</span> <span class="s1">&#39;10d&#39;</span><span class="p">,</span> <span class="s1">&#39;Jd &#39;</span><span class="p">,</span> <span class="s1">&#39;Qd &#39;</span><span class="p">,</span> <span class="s1">&#39;Kd &#39;</span><span class="p">,</span> <span class="s1">&#39;As &#39;</span><span class="p">,</span> <span class="s1">&#39;2s &#39;</span><span class="p">,</span> <span class="s1">&#39;3s &#39;</span><span class="p">,</span> <span class="s1">&#39;4s &#39;</span><span class="p">,</span> <span class="s1">&#39;5s &#39;</span><span class="p">,</span> <span class="s1">&#39;6s &#39;</span><span class="p">,</span> <span class="s1">&#39;7s &#39;</span><span class="p">,</span> <span class="s1">&#39;8s &#39;</span><span class="p">,</span> <span class="s1">&#39;9s &#39;</span><span class="p">,</span> <span class="s1">&#39;10s&#39;</span><span class="p">,</span> <span class="s1">&#39;Js &#39;</span><span class="p">,</span> <span class="s1">&#39;Qs &#39;</span><span class="p">,</span> <span class="s1">&#39;Ks &#39;</span><span class="p">,</span> <span class="s1">&#39;Ac &#39;</span><span class="p">,</span> <span class="s1">&#39;2c &#39;</span><span class="p">,</span> <span class="s1">&#39;3c &#39;</span><span class="p">,</span> <span class="s1">&#39;4c &#39;</span><span class="p">,</span> <span class="s1">&#39;5c &#39;</span><span class="p">,</span> <span class="s1">&#39;6c &#39;</span><span class="p">,</span> <span class="s1">&#39;7c &#39;</span><span class="p">,</span> <span class="s1">&#39;8c &#39;</span><span class="p">,</span> <span class="s1">&#39;9c &#39;</span><span class="p">,</span> <span class="s1">&#39;10c&#39;</span><span class="p">,</span> <span class="s1">&#39;Jc &#39;</span><span class="p">,</span> <span class="s1">&#39;Qc &#39;</span><span class="p">,</span> <span class="s1">&#39;Kc &#39;</span><span class="o">]</span><span class="p">,</span>
<span class="lineno"> 4</span>   <span class="o">[</span><span class="s1">&#39;Ah &#39;</span><span class="p">,</span> <span class="s1">&#39;2h &#39;</span><span class="p">,</span> <span class="s1">&#39;3h &#39;</span><span class="p">,</span> <span class="s1">&#39;4h &#39;</span><span class="p">,</span> <span class="s1">&#39;5h &#39;</span><span class="p">,</span> <span class="s1">&#39;6h &#39;</span><span class="p">,</span> <span class="s1">&#39;7h &#39;</span><span class="p">,</span> <span class="s1">&#39;8h &#39;</span><span class="p">,</span> <span class="s1">&#39;9h &#39;</span><span class="p">,</span> <span class="s1">&#39;10h&#39;</span><span class="p">,</span> <span class="s1">&#39;Jh &#39;</span><span class="p">,</span> <span class="s1">&#39;Qh &#39;</span><span class="p">,</span> <span class="s1">&#39;Kh &#39;</span><span class="p">,</span><span class="s1">&#39;Ad &#39;</span><span class="p">,</span> <span class="s1">&#39;2d &#39;</span><span class="p">,</span> <span class="s1">&#39;3d &#39;</span><span class="p">,</span> <span class="s1">&#39;4d &#39;</span><span class="p">,</span> <span class="s1">&#39;5d &#39;</span><span class="p">,</span> <span class="s1">&#39;6d &#39;</span><span class="p">,</span> <span class="s1">&#39;7d &#39;</span><span class="p">,</span> <span class="s1">&#39;8d &#39;</span><span class="p">,</span> <span class="s1">&#39;9d &#39;</span><span class="p">,</span> <span class="s1">&#39;10d&#39;</span><span class="p">,</span> <span class="s1">&#39;Jd &#39;</span><span class="p">,</span> <span class="s1">&#39;Qd &#39;</span><span class="p">,</span> <span class="s1">&#39;Kd &#39;</span><span class="p">,</span> <span class="s1">&#39;As &#39;</span><span class="p">,</span> <span class="s1">&#39;2s &#39;</span><span class="p">,</span> <span class="s1">&#39;3s &#39;</span><span class="p">,</span> <span class="s1">&#39;4s &#39;</span><span class="p">,</span> <span class="s1">&#39;5s &#39;</span><span class="p">,</span> <span class="s1">&#39;6s &#39;</span><span class="p">,</span> <span class="s1">&#39;7s &#39;</span><span class="p">,</span> <span class="s1">&#39;8s &#39;</span><span class="p">,</span> <span class="s1">&#39;9s &#39;</span><span class="p">,</span> <span class="s1">&#39;10s&#39;</span><span class="p">,</span> <span class="s1">&#39;Js &#39;</span><span class="p">,</span> <span class="s1">&#39;Qs &#39;</span><span class="p">,</span> <span class="s1">&#39;Ks &#39;</span><span class="p">,</span> <span class="s1">&#39;Ac &#39;</span><span class="p">,</span> <span class="s1">&#39;2c &#39;</span><span class="p">,</span> <span class="s1">&#39;3c &#39;</span><span class="p">,</span> <span class="s1">&#39;4c &#39;</span><span class="p">,</span> <span class="s1">&#39;5c &#39;</span><span class="p">,</span> <span class="s1">&#39;6c &#39;</span><span class="p">,</span> <span class="s1">&#39;7c &#39;</span><span class="p">,</span> <span class="s1">&#39;8c &#39;</span><span class="p">,</span> <span class="s1">&#39;9c &#39;</span><span class="p">,</span> <span class="s1">&#39;10c&#39;</span><span class="p">,</span> <span class="s1">&#39;Jc &#39;</span><span class="p">,</span> <span class="s1">&#39;Qc &#39;</span><span class="p">,</span> <span class="s1">&#39;Kc &#39;</span><span class="o">]</span>
<span class="lineno"> 5</span> <span class="o">]</span>
<span class="lineno"> 6</span> 
<span class="lineno"> 7</span> <span class="c1"># two empty arrays to store the players hands</span>
<span class="lineno"> 8</span> <span class="n">player</span> <span class="o">=</span> <span class="o">[]</span>
<span class="lineno"> 9</span> <span class="n">dealer</span> <span class="o">=</span> <span class="o">[]</span>
<span class="lineno">10</span> 
<span class="lineno">11</span> 
<span class="lineno">12</span> <span class="c1"># deals cards </span>
<span class="lineno">13</span> <span class="mi">2</span><span class="o">.</span><span class="n">times</span> <span class="k">do</span>
<span class="lineno">14</span>   <span class="n">player</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="n">decks</span><span class="o">.</span><span class="n">sample</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">decks</span><span class="o">.</span><span class="n">sample</span><span class="o">.</span><span class="n">sample</span><span class="p">))</span>
<span class="lineno">15</span>   <span class="n">dealer</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="n">decks</span><span class="o">.</span><span class="n">sample</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">decks</span><span class="o">.</span><span class="n">sample</span><span class="o">.</span><span class="n">sample</span><span class="p">))</span>
<span class="lineno">16</span> <span class="k">end</span>
<span class="lineno">17</span> 
<span class="lineno">18</span> <span class="c1"># calculate total of cards in a hand</span>
<span class="lineno">19</span> <span class="k">def</span> <span class="nf">calculate_total</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
<span class="lineno">20</span>   <span class="n">running_total</span> <span class="o">=</span> <span class="mi">0</span>
<span class="lineno">21</span>   <span class="n">array</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">card</span><span class="o">|</span>
<span class="lineno">22</span>     <span class="k">if</span> <span class="n">card</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;A&#39;</span>
<span class="lineno">23</span>       <span class="n">running_total</span> <span class="o">=</span> <span class="n">running_total</span> <span class="o">+</span> <span class="mi">11</span>
<span class="lineno">24</span>     <span class="k">elsif</span> <span class="n">card</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;J&#39;</span> <span class="o">||</span> <span class="n">card</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;Q&#39;</span> <span class="o">||</span> <span class="n">card</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;K&#39;</span> <span class="o">||</span> <span class="n">card</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="mi">0</span><span class="o">.</span><span class="n">.</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;10&#39;</span>
<span class="lineno">25</span>       <span class="n">running_total</span> <span class="o">=</span> <span class="n">running_total</span> <span class="o">+</span> <span class="mi">10</span>
<span class="lineno">26</span>     <span class="k">else</span> 
<span class="lineno">27</span>       <span class="n">running_total</span> <span class="o">=</span> <span class="n">running_total</span> <span class="o">+</span> <span class="n">card</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">to_i</span>      
<span class="lineno">28</span>     <span class="k">end</span>
<span class="lineno">29</span>   <span class="k">end</span>
<span class="lineno">30</span>   <span class="n">running_total</span>
<span class="lineno">31</span> <span class="k">end</span>
<span class="lineno">32</span> 
<span class="lineno">33</span> <span class="c1"># player hit or stay method </span>
<span class="lineno">34</span> <span class="k">def</span> <span class="nf">player_hit_or_stay</span><span class="p">(</span><span class="n">running_total</span><span class="p">,</span> <span class="n">decks</span><span class="p">,</span> <span class="n">player</span><span class="p">)</span>
<span class="lineno">35</span>   <span class="k">if</span> <span class="n">running_total</span> <span class="o">==</span> <span class="mi">21</span>
<span class="lineno">36</span>     <span class="nb">puts</span> <span class="s2">&quot;BLACKJACK!!!!&quot;</span>
<span class="lineno">37</span>     <span class="nb">exit</span>
<span class="lineno">38</span>   <span class="k">elsif</span> <span class="n">running_total</span> <span class="o">&lt;=</span> <span class="mi">20</span>
<span class="lineno">39</span>     <span class="nb">puts</span> <span class="s1">&#39;Hit(h) or Stay(s)?&#39;</span>
<span class="lineno">40</span>     <span class="n">answer</span> <span class="o">=</span> <span class="nb">gets</span><span class="o">.</span><span class="n">chomp</span><span class="o">.</span><span class="n">downcase</span>
<span class="lineno">41</span>     <span class="k">while</span> <span class="n">answer</span> <span class="o">!=</span> <span class="s1">&#39;h&#39;</span> <span class="o">&amp;&amp;</span> <span class="n">answer</span> <span class="o">!=</span> <span class="s1">&#39;s&#39;</span>
<span class="lineno">42</span>       <span class="nb">puts</span> <span class="s1">&#39;Press &quot;h&quot; to hit or press &quot;s&quot; to stay&#39;</span>
<span class="lineno">43</span>       <span class="n">answer</span> <span class="o">=</span> <span class="nb">gets</span><span class="o">.</span><span class="n">chomp</span><span class="o">.</span><span class="n">downcase</span>
<span class="lineno">44</span>     <span class="k">end</span>
<span class="lineno">45</span>     <span class="k">if</span> <span class="n">answer</span> <span class="o">==</span> <span class="s1">&#39;h&#39;</span>
<span class="lineno">46</span>       <span class="n">hit</span><span class="p">(</span><span class="n">decks</span><span class="o">.</span><span class="n">sample</span><span class="p">,</span> <span class="n">player</span><span class="p">)</span>
<span class="lineno">47</span>       <span class="nb">p</span> <span class="n">player</span>
<span class="lineno">48</span>     <span class="k">end</span>
<span class="lineno">49</span>   <span class="k">end</span>
<span class="lineno">50</span> <span class="k">end</span>
<span class="lineno">51</span> 
<span class="lineno">52</span> <span class="c1"># dealer hit or stay method </span>
<span class="lineno">53</span> <span class="k">def</span> <span class="nf">dealer_hit_or_stay</span><span class="p">(</span><span class="n">running_total</span><span class="p">)</span>
<span class="lineno">54</span>   <span class="k">if</span> <span class="n">running_total</span> <span class="o">==</span> <span class="mi">21</span>
<span class="lineno">55</span>     <span class="nb">puts</span> <span class="s1">&#39;DEALER HAS BLACKJACK!&#39;</span>
<span class="lineno">56</span>   <span class="k">elsif</span> <span class="n">running_total</span> <span class="o">&lt;</span> <span class="mi">17</span> 
<span class="lineno">57</span>     <span class="nb">puts</span> <span class="s1">&#39;Dealer Hits&#39;</span>
<span class="lineno">58</span>   <span class="k">elsif</span> <span class="n">running_total</span> <span class="o">&gt;=</span> <span class="mi">17</span> <span class="o">&amp;&amp;</span> <span class="n">running_total</span> <span class="o">&lt;=</span> <span class="mi">18</span>
<span class="lineno">59</span>     <span class="nb">puts</span> <span class="s1">&#39;Dealer randomally selects h or s&#39;</span>
<span class="lineno">60</span>   <span class="k">elsif</span> <span class="n">running_total</span> <span class="o">&gt;=</span> <span class="mi">19</span> <span class="o">&amp;&amp;</span> <span class="n">running_total</span> <span class="o">&lt;=</span> <span class="mi">20</span>
<span class="lineno">61</span>     <span class="nb">puts</span> <span class="s1">&#39;Dealer Stays!&#39;</span>
<span class="lineno">62</span>   <span class="k">end</span>
<span class="lineno">63</span> <span class="k">end</span>
<span class="lineno">64</span> 
<span class="lineno">65</span> <span class="c1"># deal new card method</span>
<span class="lineno">66</span> <span class="k">def</span> <span class="nf">hit</span><span class="p">(</span><span class="n">deck</span><span class="p">,</span> <span class="n">hand</span><span class="p">)</span>
<span class="lineno">67</span>   <span class="n">hand</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="n">deck</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">deck</span><span class="o">.</span><span class="n">sample</span><span class="p">))</span>
<span class="lineno">68</span>   <span class="n">calculate_total</span><span class="p">(</span><span class="n">hand</span><span class="p">)</span>
<span class="lineno">69</span> <span class="k">end</span></code></pre></div>

<h4>The pry-byebug gem</h4>
<p>I was looking for a way to stop my programs at certain points and then step by step move on from the break point. Someone on the #ruby irc chanel linked me to the <a href="https://github.com/deivid-rodriguez/pry-byebug">pry-byebug gem</a>. It does exactly what I needed which is very useful for debugging.</p>

<p>Back to my game..</p>

<h3>Dealing with aces</h3>

<p>So after a few hours short break I returned to my program to tackle the Ace in the pack issue. Basically if the player has an ace in their hand then I want the program to output the two scores, for instance if you had an ace and a 4 you should get a message along the lines of:</p>

<p><span class="terminal">You have 5 or 15</span></p>

<p>If you had an ace, 7 and an 8 you should get the message:</p>

<p><span class="terminal">You have 16</span></p>

<p>In the second example it should only output one total as the other (11+7+8) exceeds 21 and therefor is unplayable.</p>

<p>So I need to track two totals in case an ace appears at any stage. I can then write some code that will check for an ace and if it exists add 1 to the first total and add 11 to the second.</p>

<p>So I reworked my calculate_total method to this:</p>

<div class="highlight"><pre><code class="ruby"><span class="lineno"> 1</span> <span class="c1"># calc total</span>
<span class="lineno"> 2</span> <span class="k">def</span> <span class="nf">calculate_total</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
<span class="lineno"> 3</span>   <span class="n">running_totals</span> <span class="o">=</span> <span class="p">{</span><span class="ss">:total1</span> <span class="o">=&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="ss">:total2</span> <span class="o">=&gt;</span> <span class="mi">0</span><span class="p">}</span>
<span class="lineno"> 4</span>   <span class="n">array</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">card</span><span class="o">|</span>
<span class="lineno"> 5</span>     <span class="k">if</span> <span class="n">card</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;A&#39;</span>     
<span class="lineno"> 6</span>         <span class="n">running_totals</span><span class="o">[</span><span class="ss">:total1</span><span class="o">]</span> <span class="o">=</span> <span class="n">running_totals</span><span class="o">[</span><span class="ss">:total1</span><span class="o">]</span> <span class="o">+</span> <span class="mi">1</span>
<span class="lineno"> 7</span>         <span class="n">running_totals</span><span class="o">[</span><span class="ss">:total2</span><span class="o">]</span> <span class="o">=</span> <span class="n">running_totals</span><span class="o">[</span><span class="ss">:total2</span><span class="o">]</span> <span class="o">+</span> <span class="mi">11</span>  
<span class="lineno"> 8</span>         <span class="n">ace_in_pack</span> <span class="o">=</span> <span class="kp">true</span>      
<span class="lineno"> 9</span>     <span class="k">elsif</span> <span class="n">card</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;J&#39;</span> <span class="o">||</span> <span class="n">card</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;Q&#39;</span> <span class="o">||</span> <span class="n">card</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;K&#39;</span> <span class="o">||</span> <span class="n">card</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="mi">0</span><span class="o">.</span><span class="n">.</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;10&#39;</span>
<span class="lineno">10</span>       <span class="n">running_totals</span><span class="o">[</span><span class="ss">:total1</span><span class="o">]</span> <span class="o">=</span> <span class="n">running_totals</span><span class="o">[</span><span class="ss">:total1</span><span class="o">]</span> <span class="o">+</span> <span class="mi">10</span>
<span class="lineno">11</span>       <span class="n">running_totals</span><span class="o">[</span><span class="ss">:total2</span><span class="o">]</span> <span class="o">=</span> <span class="n">running_totals</span><span class="o">[</span><span class="ss">:total2</span><span class="o">]</span> <span class="o">+</span> <span class="mi">10</span>
<span class="lineno">12</span>     <span class="k">else</span> 
<span class="lineno">13</span>       <span class="n">running_totals</span><span class="o">[</span><span class="ss">:total1</span><span class="o">]</span> <span class="o">=</span> <span class="n">running_totals</span><span class="o">[</span><span class="ss">:total1</span><span class="o">]</span> <span class="o">+</span> <span class="n">card</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">to_i</span>      
<span class="lineno">14</span>       <span class="n">running_totals</span><span class="o">[</span><span class="ss">:total2</span><span class="o">]</span> <span class="o">=</span> <span class="n">running_totals</span><span class="o">[</span><span class="ss">:total2</span><span class="o">]</span> <span class="o">+</span> <span class="n">card</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">to_i</span>      
<span class="lineno">15</span>     <span class="k">end</span>
<span class="lineno">16</span>   <span class="k">end</span>
<span class="lineno">17</span>   <span class="n">running_totals</span>
<span class="lineno">18</span> <span class="k">end</span></code></pre></div>

<p>The first version of this was just to get the method working in a fashion but now the method has two running totals to handle instances where an Ace is present and there are two possible totals. So my method handles this pretty well by checking if the card is an Ace and if it is increment total1 by 1 and total2 by 11. Excellent!!</p>

<p>Here are some outcomes:</p>

<div class="terminal">
<p>7h, 5s</p>
<p>Your current score is 12</p>
<p>Hit(h) or Stay(s)</p>
</div>

<div class="terminal">
<p>6d, 2c</p>
<p>Your current score is 8</p>
<p>Hit(h) or Stay(s)</p>
</div>

<div class="terminal">
<p>Ah, 4s</p>
<p>Your current score is 5 or 15</p>
<p>Hit(h) or Stay(s)</p>
</div>

<div class="terminal">
<p>Ah, As</p>
<p>Your current score is 2</p>
<p>Hit(h) or Stay(s)</p>
</div>

<p>Great st…. hang on what’s going on in the last example? Shouldn’t that say you have 2 or 12?</p>

<p>The reason it breaks is because for the first iteration of array.each it adds 1 to total1 and 11 to total2 and on the second iteration it again adds 1 to total1 and 11 to total2 giving a total of 2 for total1 and 22 for total2 and therefore busting total2. </p>

<p>If I’m dealt two aces I should have:</p>

<p><span class="terminal">“You have 2 or 12</span></p>

<p>What my program needs to do in this rare but highly possible scenario is check to see if there is already an ace in the pack and if there is then add 1 to both total1 and total2 not add another 11 to total2.</p>

<p>So I created a new variable local to the calculate_total method that tracks if the is an ace in the pack. Here is the newly written method:</p>

<div class="highlight"><pre><code class="ruby"><span class="lineno"> 1</span> <span class="c1"># calc total</span>
<span class="lineno"> 2</span> <span class="k">def</span> <span class="nf">calculate_total</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
<span class="lineno"> 3</span>   <span class="n">running_totals</span> <span class="o">=</span> <span class="p">{</span><span class="ss">:total1</span> <span class="o">=&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="ss">:total2</span> <span class="o">=&gt;</span> <span class="mi">0</span><span class="p">}</span>
<span class="lineno"> 4</span>   <span class="n">ace_in_pack</span> <span class="o">=</span> <span class="kp">false</span>
<span class="lineno"> 5</span>   <span class="n">array</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">card</span><span class="o">|</span>
<span class="lineno"> 6</span>     <span class="k">if</span> <span class="n">card</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;A&#39;</span>
<span class="lineno"> 7</span>       <span class="k">if</span> <span class="n">ace_in_pack</span> <span class="o">==</span> <span class="kp">true</span>
<span class="lineno"> 8</span>         <span class="n">running_totals</span><span class="o">[</span><span class="ss">:total1</span><span class="o">]</span> <span class="o">=</span> <span class="n">running_totals</span><span class="o">[</span><span class="ss">:total1</span><span class="o">]</span> <span class="o">+</span> <span class="mi">1</span>
<span class="lineno"> 9</span>         <span class="n">running_totals</span><span class="o">[</span><span class="ss">:total2</span><span class="o">]</span> <span class="o">=</span> <span class="n">running_totals</span><span class="o">[</span><span class="ss">:total2</span><span class="o">]</span> <span class="o">+</span> <span class="mi">1</span>        
<span class="lineno">10</span>       <span class="k">elsif</span> <span class="n">ace_in_pack</span> <span class="o">==</span> <span class="kp">false</span>
<span class="lineno">11</span>         <span class="n">running_totals</span><span class="o">[</span><span class="ss">:total1</span><span class="o">]</span> <span class="o">=</span> <span class="n">running_totals</span><span class="o">[</span><span class="ss">:total1</span><span class="o">]</span> <span class="o">+</span> <span class="mi">1</span>
<span class="lineno">12</span>         <span class="n">running_totals</span><span class="o">[</span><span class="ss">:total2</span><span class="o">]</span> <span class="o">=</span> <span class="n">running_totals</span><span class="o">[</span><span class="ss">:total2</span><span class="o">]</span> <span class="o">+</span> <span class="mi">11</span>  
<span class="lineno">13</span>         <span class="n">ace_in_pack</span> <span class="o">=</span> <span class="kp">true</span>      
<span class="lineno">14</span>       <span class="k">end</span>    
<span class="lineno">15</span>     <span class="k">elsif</span> <span class="n">card</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;J&#39;</span> <span class="o">||</span> <span class="n">card</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;Q&#39;</span> <span class="o">||</span> <span class="n">card</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;K&#39;</span> <span class="o">||</span> <span class="n">card</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="mi">0</span><span class="o">.</span><span class="n">.</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;10&#39;</span>
<span class="lineno">16</span>       <span class="n">running_totals</span><span class="o">[</span><span class="ss">:total1</span><span class="o">]</span> <span class="o">=</span> <span class="n">running_totals</span><span class="o">[</span><span class="ss">:total1</span><span class="o">]</span> <span class="o">+</span> <span class="mi">10</span>
<span class="lineno">17</span>       <span class="n">running_totals</span><span class="o">[</span><span class="ss">:total2</span><span class="o">]</span> <span class="o">=</span> <span class="n">running_totals</span><span class="o">[</span><span class="ss">:total2</span><span class="o">]</span> <span class="o">+</span> <span class="mi">10</span>
<span class="lineno">18</span>     <span class="k">else</span> 
<span class="lineno">19</span>       <span class="n">running_totals</span><span class="o">[</span><span class="ss">:total1</span><span class="o">]</span> <span class="o">=</span> <span class="n">running_totals</span><span class="o">[</span><span class="ss">:total1</span><span class="o">]</span> <span class="o">+</span> <span class="n">card</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">to_i</span>      
<span class="lineno">20</span>       <span class="n">running_totals</span><span class="o">[</span><span class="ss">:total2</span><span class="o">]</span> <span class="o">=</span> <span class="n">running_totals</span><span class="o">[</span><span class="ss">:total2</span><span class="o">]</span> <span class="o">+</span> <span class="n">card</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">to_i</span>      
<span class="lineno">21</span>     <span class="k">end</span>
<span class="lineno">22</span>   <span class="k">end</span>
<span class="lineno">23</span>   <span class="n">running_totals</span>
<span class="lineno">24</span> <span class="k">end</span></code></pre></div>

<p>Now that’s far slicker. Line 4 is where i’ve declared the ace_in_pack variable to an initial value of false and now in the event of an Ace being present I have added a new conditional to check to see if there is already an Ace in the array. If there is then each total increments by 1 and if there isn’t an Ace present then we carry on as normal adding 1 to total1 and 11 to total2 and then reset ace_in_pack to true.</p>

<p>I spent a few days away from my program partly due to time constraints and partly due to allowing myself some thinking time. I came back to it today a finished the program and I’m pretty happy with it but I’ve learnt that orgainization is so important when designing and executing my programs.</p>

<p>I like to always know where I am and exactly what every line of my program is doing and I found that after a while writing this game I was losing myself in the code and forgetting what part does what and how one method interacts with another. I got there in the end and as a version 1 I suppose it’s a nice foundation but I should probably refactor it and adopt the DRY principle in a few places.</p>

<p>My final code: Well before I refactor it I guess.</p>

<div class="highlight"><pre><code class="ruby"><span class="lineno">  1</span> <span class="c1"># Initialize deck of cards</span>
<span class="lineno">  2</span>   <span class="c1"># Deal two random cards each to player(s) and dealer </span>
<span class="lineno">  3</span>   <span class="c1"># Remove the dealt cards from the deck as they are dealt</span>
<span class="lineno">  4</span>     <span class="c1"># Player &#39;Hits&#39; or &#39;Stays&#39; or has BJ</span>
<span class="lineno">  5</span>       <span class="c1"># if player has BJ play moves to Dealer</span>
<span class="lineno">  6</span>       <span class="c1"># if player hits then another card is dealt</span>
<span class="lineno">  7</span>       <span class="c1"># if total exceeds 21 player busts comp wins, else if player has &gt; 16 &amp;&amp; &lt; 20 player can &#39;Hit&#39; or &#39;Stay&#39;, else &#39;Hit&#39; </span>
<span class="lineno">  8</span>       <span class="c1"># Remove dealt cards from deck array</span>
<span class="lineno">  9</span>       <span class="c1"># continue until &#39;Stay&#39; or &#39;Bust&#39;</span>
<span class="lineno"> 10</span>         <span class="c1"># Dealer plays if Player &#39;Stayed&#39; or has BJ</span>
<span class="lineno"> 11</span>           <span class="c1"># if dealer cards == BJ &amp;&amp; players cards == BJ its a draw</span>
<span class="lineno"> 12</span>           <span class="c1"># else if dealers cards &lt; 16 dealer &#39;Hits&#39;</span>
<span class="lineno"> 13</span>           <span class="c1"># else if dealers cards &gt; 16 &amp;&amp; &lt; 19 random (&#39;Hit&#39; or &#39;Stay&#39;)</span>
<span class="lineno"> 14</span>           <span class="c1"># else if dealers cards &gt;= 19 &amp;&amp; &lt;= 21 &#39;Stay&#39;</span>
<span class="lineno"> 15</span>           <span class="c1"># else bust </span>
<span class="lineno"> 16</span>             <span class="c1"># Result compares </span>
<span class="lineno"> 17</span>               <span class="c1"># play again?</span>
<span class="lineno"> 18</span> 
<span class="lineno"> 19</span> <span class="c1"># 2...9 = face value , 10,J,Q,K = 10, A = 1 or 11</span>
<span class="lineno"> 20</span> <span class="c1"># 4 different suits</span>
<span class="lineno"> 21</span> <span class="c1"># 52 cards in total</span>
<span class="lineno"> 22</span> 
<span class="lineno"> 23</span> 
<span class="lineno"> 24</span> 
<span class="lineno"> 25</span> <span class="nb">require</span><span class="p">(</span><span class="s1">&#39;pry&#39;</span><span class="p">)</span>
<span class="lineno"> 26</span> 
<span class="lineno"> 27</span> <span class="c1">#  M   M  MMMM  MMMMM  M   M  MMMMM  MMMM   MMMMM</span>
<span class="lineno"> 28</span> <span class="c1">#  MM MM  M       M    M   M  M   M  M   M  M</span>
<span class="lineno"> 29</span> <span class="c1">#  M M M  MMM     M    MMMMM  M   M  M   M   MMM </span>
<span class="lineno"> 30</span> <span class="c1">#  M   M  M       M    M   M  M   M  M   M      M</span>
<span class="lineno"> 31</span> <span class="c1">#  M   M  MMMM    M    M   M  MMMMM  MMMM   MMMMM</span>
<span class="lineno"> 32</span> 
<span class="lineno"> 33</span> <span class="c1"># deals cards</span>
<span class="lineno"> 34</span> <span class="k">def</span> <span class="nf">deal</span><span class="p">(</span><span class="n">player</span><span class="p">,</span> <span class="n">dealer</span><span class="p">,</span> <span class="n">decks</span><span class="p">)</span>
<span class="lineno"> 35</span>   <span class="nb">system</span> <span class="s1">&#39;clear&#39;</span>
<span class="lineno"> 36</span>   <span class="mi">2</span><span class="o">.</span><span class="n">times</span> <span class="k">do</span>
<span class="lineno"> 37</span>     <span class="n">player</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="n">decks</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">decks</span><span class="o">.</span><span class="n">sample</span><span class="p">))</span>
<span class="lineno"> 38</span>     <span class="n">dealer</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="n">decks</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">decks</span><span class="o">.</span><span class="n">sample</span><span class="p">))</span>
<span class="lineno"> 39</span>   <span class="k">end</span>
<span class="lineno"> 40</span>   <span class="n">display_cards</span><span class="p">(</span><span class="n">player</span><span class="p">)</span>
<span class="lineno"> 41</span> <span class="k">end</span>
<span class="lineno"> 42</span> 
<span class="lineno"> 43</span> <span class="c1"># displays the cards and tell player their score </span>
<span class="lineno"> 44</span> <span class="k">def</span> <span class="nf">display_cards</span><span class="p">(</span><span class="n">hands</span><span class="p">)</span>
<span class="lineno"> 45</span>   <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
<span class="lineno"> 46</span>   <span class="nb">puts</span> <span class="s1">&#39;PLAYERS CARDS&#39;</span>
<span class="lineno"> 47</span>   <span class="n">hands</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">card</span><span class="o">|</span>
<span class="lineno"> 48</span>     <span class="nb">puts</span> <span class="s2">&quot; _____ &quot;</span>
<span class="lineno"> 49</span>     <span class="nb">puts</span> <span class="s2">&quot;|     |&quot;</span>
<span class="lineno"> 50</span>     <span class="nb">puts</span> <span class="s2">&quot;| </span><span class="si">#{</span><span class="n">hands</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="si">}</span><span class="s2"> |&quot;</span>
<span class="lineno"> 51</span>     <span class="nb">puts</span> <span class="s2">&quot;|     |&quot;</span>
<span class="lineno"> 52</span>     <span class="nb">puts</span> <span class="s2">&quot; ----- &quot;</span>
<span class="lineno"> 53</span>     <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
<span class="lineno"> 54</span>   <span class="k">end</span>
<span class="lineno"> 55</span> <span class="k">end</span>
<span class="lineno"> 56</span> 
<span class="lineno"> 57</span> <span class="c1"># Dealer shows hand</span>
<span class="lineno"> 58</span> <span class="k">def</span> <span class="nf">dealer_shows</span><span class="p">(</span><span class="n">dealers_hand</span><span class="p">,</span> <span class="n">players_hand</span><span class="p">,</span> <span class="n">running_total1</span><span class="p">,</span> <span class="n">running_total2</span><span class="p">)</span>
<span class="lineno"> 59</span>   <span class="nb">system</span> <span class="s1">&#39;clear&#39;</span>
<span class="lineno"> 60</span>   <span class="n">player_final_score</span><span class="p">(</span><span class="n">running_total1</span><span class="p">,</span> <span class="n">running_total2</span><span class="p">)</span>
<span class="lineno"> 61</span>   <span class="n">display_cards</span><span class="p">(</span><span class="n">players_hand</span><span class="p">)</span>
<span class="lineno"> 62</span>   <span class="nb">puts</span> 
<span class="lineno"> 63</span>   <span class="nb">puts</span>
<span class="lineno"> 64</span>   <span class="nb">puts</span> <span class="s2">&quot;DEALERS CARDS&quot;</span>
<span class="lineno"> 65</span>   <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
<span class="lineno"> 66</span>   <span class="n">dealers_hand</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">card</span><span class="o">|</span>
<span class="lineno"> 67</span>     <span class="nb">puts</span> <span class="s2">&quot; _____ &quot;</span>
<span class="lineno"> 68</span>     <span class="nb">puts</span> <span class="s2">&quot;|     |&quot;</span>
<span class="lineno"> 69</span>     <span class="nb">puts</span> <span class="s2">&quot;| </span><span class="si">#{</span><span class="n">dealers_hand</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="si">}</span><span class="s2"> |&quot;</span>
<span class="lineno"> 70</span>     <span class="nb">puts</span> <span class="s2">&quot;|     |&quot;</span>
<span class="lineno"> 71</span>     <span class="nb">puts</span> <span class="s2">&quot; ----- &quot;</span>
<span class="lineno"> 72</span>     <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
<span class="lineno"> 73</span>   <span class="k">end</span>
<span class="lineno"> 74</span> <span class="k">end</span>
<span class="lineno"> 75</span> 
<span class="lineno"> 76</span> <span class="k">def</span> <span class="nf">player_final_score</span><span class="p">(</span><span class="n">running_total1</span><span class="p">,</span><span class="n">running_total2</span><span class="p">)</span>
<span class="lineno"> 77</span>   <span class="k">if</span> <span class="n">running_total1</span> <span class="o">&lt;=</span> <span class="mi">21</span> <span class="o">&amp;&amp;</span> <span class="n">running_total2</span> <span class="o">&lt;=</span> <span class="mi">21</span> <span class="o">&amp;&amp;</span> <span class="n">running_total2</span> <span class="o">&gt;</span> <span class="n">running_total1</span>
<span class="lineno"> 78</span>     <span class="k">return</span> <span class="n">running_total2</span>
<span class="lineno"> 79</span>   <span class="k">else</span>
<span class="lineno"> 80</span>     <span class="k">return</span> <span class="n">running_total1</span>
<span class="lineno"> 81</span>   <span class="k">end</span>
<span class="lineno"> 82</span> <span class="k">end</span>
<span class="lineno"> 83</span> 
<span class="lineno"> 84</span> <span class="c1"># say score</span>
<span class="lineno"> 85</span> <span class="k">def</span> <span class="nf">say_score</span><span class="p">(</span><span class="n">hands</span><span class="p">,</span> <span class="n">person</span><span class="p">)</span>
<span class="lineno"> 86</span>   <span class="n">total1</span> <span class="o">=</span> <span class="n">calculate_total</span><span class="p">(</span><span class="n">hands</span><span class="p">)</span><span class="o">[</span><span class="ss">:total1</span><span class="o">]</span>
<span class="lineno"> 87</span>   <span class="n">total2</span> <span class="o">=</span> <span class="n">calculate_total</span><span class="p">(</span><span class="n">hands</span><span class="p">)</span><span class="o">[</span><span class="ss">:total2</span><span class="o">]</span>
<span class="lineno"> 88</span>   <span class="k">if</span> <span class="n">total1</span> <span class="o">==</span> <span class="mi">21</span> <span class="o">||</span> <span class="n">total2</span> <span class="o">==</span> <span class="mi">21</span>
<span class="lineno"> 89</span>     <span class="nb">puts</span> 
<span class="lineno"> 90</span>   <span class="k">elsif</span> <span class="n">total1</span> <span class="o">==</span> <span class="n">total2</span> 
<span class="lineno"> 91</span>     <span class="nb">puts</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">person</span><span class="si">}</span><span class="s2"> has </span><span class="si">#{</span><span class="n">total1</span><span class="si">}</span><span class="s2">&quot;</span>  
<span class="lineno"> 92</span>   <span class="k">elsif</span> <span class="n">total1</span> <span class="o">&lt;=</span> <span class="mi">21</span> <span class="o">&amp;&amp;</span> <span class="n">total2</span> <span class="o">&lt;=</span> <span class="mi">21</span>
<span class="lineno"> 93</span>     <span class="nb">puts</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">person</span><span class="si">}</span><span class="s2"> has </span><span class="si">#{</span><span class="n">total1</span><span class="si">}</span><span class="s2"> or </span><span class="si">#{</span><span class="n">total2</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="lineno"> 94</span>   <span class="k">elsif</span> <span class="n">total2</span> <span class="o">&gt;</span> <span class="mi">21</span>
<span class="lineno"> 95</span>     <span class="nb">puts</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">person</span><span class="si">}</span><span class="s2"> has </span><span class="si">#{</span><span class="n">total1</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="lineno"> 96</span>   <span class="k">end</span>
<span class="lineno"> 97</span> <span class="k">end</span>
<span class="lineno"> 98</span> 
<span class="lineno"> 99</span> <span class="c1"># calc total</span>
<span class="lineno">100</span> <span class="k">def</span> <span class="nf">calculate_total</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
<span class="lineno">101</span>   <span class="n">running_totals</span> <span class="o">=</span> <span class="p">{</span><span class="ss">:total1</span> <span class="o">=&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="ss">:total2</span> <span class="o">=&gt;</span> <span class="mi">0</span><span class="p">}</span>
<span class="lineno">102</span>   <span class="n">ace_in_pack</span> <span class="o">=</span> <span class="kp">false</span>
<span class="lineno">103</span>   <span class="n">array</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">card</span><span class="o">|</span>
<span class="lineno">104</span>     <span class="k">if</span> <span class="n">card</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;A&#39;</span>
<span class="lineno">105</span>       <span class="k">if</span> <span class="n">ace_in_pack</span> <span class="o">==</span> <span class="kp">true</span>
<span class="lineno">106</span>         <span class="n">running_totals</span><span class="o">[</span><span class="ss">:total1</span><span class="o">]</span> <span class="o">=</span> <span class="n">running_totals</span><span class="o">[</span><span class="ss">:total1</span><span class="o">]</span> <span class="o">+</span> <span class="mi">1</span>
<span class="lineno">107</span>         <span class="n">running_totals</span><span class="o">[</span><span class="ss">:total2</span><span class="o">]</span> <span class="o">=</span> <span class="n">running_totals</span><span class="o">[</span><span class="ss">:total2</span><span class="o">]</span> <span class="o">+</span> <span class="mi">1</span>        
<span class="lineno">108</span>       <span class="k">elsif</span> <span class="n">ace_in_pack</span> <span class="o">==</span> <span class="kp">false</span>
<span class="lineno">109</span>         <span class="n">running_totals</span><span class="o">[</span><span class="ss">:total1</span><span class="o">]</span> <span class="o">=</span> <span class="n">running_totals</span><span class="o">[</span><span class="ss">:total1</span><span class="o">]</span> <span class="o">+</span> <span class="mi">1</span>
<span class="lineno">110</span>         <span class="n">running_totals</span><span class="o">[</span><span class="ss">:total2</span><span class="o">]</span> <span class="o">=</span> <span class="n">running_totals</span><span class="o">[</span><span class="ss">:total2</span><span class="o">]</span> <span class="o">+</span> <span class="mi">11</span>  
<span class="lineno">111</span>         <span class="n">ace_in_pack</span> <span class="o">=</span> <span class="kp">true</span>      
<span class="lineno">112</span>       <span class="k">end</span>    
<span class="lineno">113</span>     <span class="k">elsif</span> <span class="n">card</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;J&#39;</span> <span class="o">||</span> <span class="n">card</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;Q&#39;</span> <span class="o">||</span> <span class="n">card</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;K&#39;</span> <span class="o">||</span> <span class="n">card</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="mi">0</span><span class="o">.</span><span class="n">.</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;10&#39;</span>
<span class="lineno">114</span>       <span class="n">running_totals</span><span class="o">[</span><span class="ss">:total1</span><span class="o">]</span> <span class="o">=</span> <span class="n">running_totals</span><span class="o">[</span><span class="ss">:total1</span><span class="o">]</span> <span class="o">+</span> <span class="mi">10</span>
<span class="lineno">115</span>       <span class="n">running_totals</span><span class="o">[</span><span class="ss">:total2</span><span class="o">]</span> <span class="o">=</span> <span class="n">running_totals</span><span class="o">[</span><span class="ss">:total2</span><span class="o">]</span> <span class="o">+</span> <span class="mi">10</span>
<span class="lineno">116</span>     <span class="k">else</span> 
<span class="lineno">117</span>       <span class="n">running_totals</span><span class="o">[</span><span class="ss">:total1</span><span class="o">]</span> <span class="o">=</span> <span class="n">running_totals</span><span class="o">[</span><span class="ss">:total1</span><span class="o">]</span> <span class="o">+</span> <span class="n">card</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">to_i</span>      
<span class="lineno">118</span>       <span class="n">running_totals</span><span class="o">[</span><span class="ss">:total2</span><span class="o">]</span> <span class="o">=</span> <span class="n">running_totals</span><span class="o">[</span><span class="ss">:total2</span><span class="o">]</span> <span class="o">+</span> <span class="n">card</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">to_i</span>      
<span class="lineno">119</span>     <span class="k">end</span>
<span class="lineno">120</span> 
<span class="lineno">121</span>   <span class="k">end</span>
<span class="lineno">122</span>   <span class="n">running_totals</span>
<span class="lineno">123</span> <span class="k">end</span>
<span class="lineno">124</span> 
<span class="lineno">125</span> <span class="c1"># player hit or stay</span>
<span class="lineno">126</span> <span class="k">def</span> <span class="nf">player_hit_or_stay</span><span class="p">(</span><span class="n">running_total1</span><span class="p">,</span> <span class="n">running_total2</span><span class="p">,</span> <span class="n">decks</span><span class="p">,</span> <span class="n">player</span><span class="p">,</span> <span class="n">dealer</span><span class="p">)</span>
<span class="lineno">127</span>   <span class="n">say_score</span><span class="p">(</span><span class="n">player</span><span class="p">,</span> <span class="s2">&quot;Player&quot;</span><span class="p">)</span>
<span class="lineno">128</span>   <span class="k">if</span> <span class="n">running_total1</span> <span class="o">&gt;</span> <span class="mi">21</span> <span class="o">&amp;&amp;</span> <span class="n">running_total2</span> <span class="o">&gt;</span> <span class="mi">21</span> 
<span class="lineno">129</span>     <span class="nb">puts</span> <span class="s2">&quot;YOU BUST!&quot;</span>
<span class="lineno">130</span>     <span class="nb">puts</span> <span class="s2">&quot;Dealer wins&quot;</span>
<span class="lineno">131</span>     <span class="nb">sleep</span> <span class="mi">1</span><span class="o">.</span><span class="mi">5</span>
<span class="lineno">132</span>     <span class="nb">puts</span> <span class="s2">&quot;GAME OVER :(&quot;</span>
<span class="lineno">133</span>   <span class="k">elsif</span> <span class="n">running_total1</span> <span class="o">==</span> <span class="mi">21</span> <span class="o">||</span> <span class="n">running_total2</span> <span class="o">==</span> <span class="mi">21</span> 
<span class="lineno">134</span>     <span class="nb">puts</span> <span class="s2">&quot;BLACKJACK!!!!&quot;</span>
<span class="lineno">135</span>     <span class="n">running_total1</span> <span class="o">=</span> <span class="n">calculate_total</span><span class="p">(</span><span class="n">player</span><span class="p">)</span><span class="o">[</span><span class="ss">:total1</span><span class="o">]</span>
<span class="lineno">136</span>     <span class="n">running_total2</span> <span class="o">=</span> <span class="n">calculate_total</span><span class="p">(</span><span class="n">player</span><span class="p">)</span><span class="o">[</span><span class="ss">:total2</span><span class="o">]</span>
<span class="lineno">137</span>     <span class="n">player_score</span> <span class="o">=</span> <span class="n">player_final_score</span><span class="p">(</span><span class="n">running_total1</span><span class="p">,</span> <span class="n">running_total2</span><span class="p">)</span>    
<span class="lineno">138</span>     <span class="n">running_total1</span> <span class="o">=</span> <span class="n">calculate_total</span><span class="p">(</span><span class="n">dealer</span><span class="p">)</span><span class="o">[</span><span class="ss">:total1</span><span class="o">]</span>
<span class="lineno">139</span>     <span class="n">running_total2</span> <span class="o">=</span> <span class="n">calculate_total</span><span class="p">(</span><span class="n">dealer</span><span class="p">)</span><span class="o">[</span><span class="ss">:total2</span><span class="o">]</span>
<span class="lineno">140</span>     <span class="n">dealer_score</span> <span class="o">=</span> <span class="n">player_final_score</span><span class="p">(</span><span class="n">running_total1</span><span class="p">,</span> <span class="n">running_total2</span><span class="p">)</span>
<span class="lineno">141</span>     <span class="nb">puts</span> <span class="n">say_score</span><span class="p">(</span><span class="n">dealer</span><span class="p">,</span> <span class="s2">&quot;Dealer&quot;</span><span class="p">)</span>
<span class="lineno">142</span>     <span class="nb">sleep</span> <span class="mi">1</span>
<span class="lineno">143</span>     <span class="n">result</span><span class="p">(</span><span class="n">player_score</span><span class="p">,</span> <span class="n">dealer_score</span><span class="p">)</span>
<span class="lineno">144</span>   <span class="k">elsif</span> <span class="n">running_total1</span> <span class="o">&lt;=</span> <span class="mi">20</span> <span class="o">||</span> <span class="n">running_total2</span> <span class="o">&lt;=</span> <span class="mi">20</span>
<span class="lineno">145</span>     <span class="nb">puts</span> <span class="s1">&#39;Hit(h) or Stay(s)?&#39;</span>
<span class="lineno">146</span>     <span class="n">answer</span> <span class="o">=</span> <span class="nb">gets</span><span class="o">.</span><span class="n">chomp</span><span class="o">.</span><span class="n">downcase</span>
<span class="lineno">147</span>     <span class="k">while</span> <span class="n">answer</span> <span class="o">!=</span> <span class="s1">&#39;h&#39;</span> <span class="o">&amp;&amp;</span> <span class="n">answer</span> <span class="o">!=</span> <span class="s1">&#39;s&#39;</span>
<span class="lineno">148</span>       <span class="nb">puts</span> <span class="s1">&#39;Press &quot;h&quot; to hit or press &quot;s&quot; to stay&#39;</span>
<span class="lineno">149</span>       <span class="n">answer</span> <span class="o">=</span> <span class="nb">gets</span><span class="o">.</span><span class="n">chomp</span><span class="o">.</span><span class="n">downcase</span>
<span class="lineno">150</span>     <span class="k">end</span>
<span class="lineno">151</span>     <span class="k">if</span> <span class="n">answer</span> <span class="o">==</span> <span class="s1">&#39;h&#39;</span>
<span class="lineno">152</span>       <span class="nb">sleep</span> <span class="mi">1</span>
<span class="lineno">153</span>       <span class="n">hit</span><span class="p">(</span><span class="n">decks</span><span class="p">,</span> <span class="n">player</span><span class="p">)</span>
<span class="lineno">154</span>       <span class="nb">system</span> <span class="s1">&#39;clear&#39;</span>
<span class="lineno">155</span>       <span class="n">display_cards</span><span class="p">(</span><span class="n">player</span><span class="p">)</span>
<span class="lineno">156</span>       <span class="n">running_total1</span> <span class="o">=</span> <span class="n">calculate_total</span><span class="p">(</span><span class="n">player</span><span class="p">)</span><span class="o">[</span><span class="ss">:total1</span><span class="o">]</span>
<span class="lineno">157</span>       <span class="n">running_total2</span> <span class="o">=</span> <span class="n">calculate_total</span><span class="p">(</span><span class="n">player</span><span class="p">)</span><span class="o">[</span><span class="ss">:total2</span><span class="o">]</span>
<span class="lineno">158</span>       <span class="n">player_hit_or_stay</span><span class="p">(</span><span class="n">running_total1</span><span class="p">,</span> <span class="n">running_total2</span><span class="p">,</span> <span class="n">decks</span><span class="p">,</span> <span class="n">player</span><span class="p">,</span> <span class="n">dealer</span><span class="p">)</span>
<span class="lineno">159</span>     <span class="k">elsif</span> <span class="n">answer</span> <span class="o">==</span> <span class="s1">&#39;s&#39;</span>
<span class="lineno">160</span>       <span class="n">dealer_shows</span><span class="p">(</span><span class="n">dealer</span><span class="p">,</span> <span class="n">player</span><span class="p">,</span> <span class="n">running_total1</span><span class="p">,</span> <span class="n">running_total2</span><span class="p">)</span>
<span class="lineno">161</span>       <span class="nb">puts</span> <span class="s2">&quot;You stayed on </span><span class="si">#{</span><span class="n">player_final_score</span><span class="p">(</span><span class="n">running_total1</span><span class="p">,</span> <span class="n">running_total2</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="lineno">162</span>       <span class="n">player_score</span> <span class="o">=</span> <span class="n">player_final_score</span><span class="p">(</span><span class="n">running_total1</span><span class="p">,</span> <span class="n">running_total2</span><span class="p">)</span>
<span class="lineno">163</span>       <span class="nb">sleep</span> <span class="mi">1</span>
<span class="lineno">164</span>       <span class="n">running_total1</span> <span class="o">=</span> <span class="n">calculate_total</span><span class="p">(</span><span class="n">dealer</span><span class="p">)</span><span class="o">[</span><span class="ss">:total1</span><span class="o">]</span>
<span class="lineno">165</span>       <span class="n">running_total2</span> <span class="o">=</span> <span class="n">calculate_total</span><span class="p">(</span><span class="n">dealer</span><span class="p">)</span><span class="o">[</span><span class="ss">:total2</span><span class="o">]</span>
<span class="lineno">166</span>       <span class="nb">puts</span> <span class="n">say_score</span><span class="p">(</span><span class="n">dealer</span><span class="p">,</span> <span class="s2">&quot;Dealer&quot;</span><span class="p">)</span>
<span class="lineno">167</span>       <span class="nb">sleep</span> <span class="mi">1</span>
<span class="lineno">168</span>       <span class="n">dealer_hit_or_stay</span><span class="p">(</span><span class="n">decks</span><span class="p">,</span><span class="n">running_total1</span><span class="p">,</span><span class="n">running_total2</span><span class="p">,</span> <span class="n">player</span><span class="p">,</span> <span class="n">dealer</span><span class="p">,</span> <span class="n">player_score</span><span class="p">)</span>
<span class="lineno">169</span>     <span class="k">end</span>
<span class="lineno">170</span>   <span class="k">end</span>
<span class="lineno">171</span> <span class="k">end</span>
<span class="lineno">172</span> 
<span class="lineno">173</span> <span class="c1"># dealer hit or stay</span>
<span class="lineno">174</span> <span class="k">def</span> <span class="nf">dealer_hit_or_stay</span><span class="p">(</span><span class="n">decks</span><span class="p">,</span> <span class="n">running_total1</span><span class="p">,</span><span class="n">running_total2</span><span class="p">,</span> <span class="n">player</span><span class="p">,</span> <span class="n">dealer</span><span class="p">,</span> <span class="n">player_score</span><span class="p">)</span>
<span class="lineno">175</span>   <span class="k">if</span> <span class="n">running_total1</span> <span class="o">&gt;</span> <span class="mi">21</span> <span class="o">&amp;&amp;</span> <span class="n">running_total2</span> <span class="o">&gt;</span> <span class="mi">21</span> 
<span class="lineno">176</span>     <span class="nb">puts</span> <span class="s2">&quot;Dealer BUST, You WIN!!!!!&quot;</span>
<span class="lineno">177</span>     <span class="nb">sleep</span> <span class="mi">0</span><span class="o">.</span><span class="mi">5</span>
<span class="lineno">178</span>     <span class="nb">puts</span> <span class="s2">&quot;Game Over :)&quot;</span>
<span class="lineno">179</span>   <span class="k">elsif</span> <span class="n">running_total1</span> <span class="o">==</span> <span class="mi">21</span> <span class="o">||</span> <span class="n">running_total2</span> <span class="o">==</span> <span class="mi">21</span>
<span class="lineno">180</span>     <span class="nb">puts</span> <span class="s1">&#39;DEALER HAS BLACKJACK!&#39;</span>
<span class="lineno">181</span>     <span class="n">running_total1</span> <span class="o">=</span> <span class="n">calculate_total</span><span class="p">(</span><span class="n">dealer</span><span class="p">)</span><span class="o">[</span><span class="ss">:total1</span><span class="o">]</span>
<span class="lineno">182</span>     <span class="n">running_total2</span> <span class="o">=</span> <span class="n">calculate_total</span><span class="p">(</span><span class="n">dealer</span><span class="p">)</span><span class="o">[</span><span class="ss">:total2</span><span class="o">]</span> 
<span class="lineno">183</span>     <span class="n">dealer_score</span> <span class="o">=</span> <span class="n">player_final_score</span><span class="p">(</span><span class="n">running_total1</span><span class="p">,</span> <span class="n">running_total2</span><span class="p">)</span>
<span class="lineno">184</span>     <span class="n">result</span><span class="p">(</span><span class="n">player_score</span><span class="p">,</span> <span class="n">dealer_score</span><span class="p">)</span>
<span class="lineno">185</span>   <span class="k">elsif</span> <span class="n">running_total1</span> <span class="o">&lt;</span> <span class="mi">17</span> <span class="o">&amp;&amp;</span> <span class="n">running_total2</span> <span class="o">&lt;</span> <span class="mi">17</span>
<span class="lineno">186</span>     <span class="nb">puts</span> <span class="s1">&#39;Dealer Hits&#39;</span>
<span class="lineno">187</span>     <span class="n">hit</span><span class="p">(</span><span class="n">decks</span><span class="p">,</span> <span class="n">dealer</span><span class="p">)</span>
<span class="lineno">188</span>     <span class="nb">sleep</span> <span class="mi">2</span>
<span class="lineno">189</span>     <span class="n">dealer_shows</span><span class="p">(</span><span class="n">dealer</span><span class="p">,</span> <span class="n">player</span><span class="p">,</span> <span class="n">running_total1</span><span class="p">,</span> <span class="n">running_total2</span><span class="p">)</span>
<span class="lineno">190</span>     <span class="nb">puts</span> <span class="s2">&quot;You stayed on </span><span class="si">#{</span><span class="n">player_score</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="lineno">191</span>     <span class="n">say_score</span><span class="p">(</span><span class="n">dealer</span><span class="p">,</span> <span class="s2">&quot;Dealer&quot;</span><span class="p">)</span>
<span class="lineno">192</span>     <span class="n">running_total1</span> <span class="o">=</span> <span class="n">calculate_total</span><span class="p">(</span><span class="n">dealer</span><span class="p">)</span><span class="o">[</span><span class="ss">:total1</span><span class="o">]</span>
<span class="lineno">193</span>     <span class="n">running_total2</span> <span class="o">=</span> <span class="n">calculate_total</span><span class="p">(</span><span class="n">dealer</span><span class="p">)</span><span class="o">[</span><span class="ss">:total2</span><span class="o">]</span> 
<span class="lineno">194</span>     <span class="n">dealer_hit_or_stay</span><span class="p">(</span><span class="n">decks</span><span class="p">,</span> <span class="n">running_total1</span><span class="p">,</span><span class="n">running_total2</span><span class="p">,</span> <span class="n">player</span><span class="p">,</span> <span class="n">dealer</span><span class="p">,</span> <span class="n">player_score</span><span class="p">)</span>
<span class="lineno">195</span>   <span class="k">elsif</span> <span class="n">running_total1</span> <span class="o">&gt;=</span> <span class="mi">17</span> <span class="o">&amp;&amp;</span> <span class="n">running_total1</span> <span class="o">&lt;=</span> <span class="mi">18</span>
<span class="lineno">196</span>     <span class="n">gamble</span> <span class="o">=</span> <span class="o">[</span><span class="s1">&#39;yes&#39;</span><span class="p">,</span> <span class="s1">&#39;no&#39;</span><span class="o">]</span>
<span class="lineno">197</span>     <span class="k">if</span> <span class="n">gamble</span><span class="o">.</span><span class="n">sample</span> <span class="o">==</span> <span class="s1">&#39;yes&#39;</span>
<span class="lineno">198</span>       <span class="nb">puts</span> <span class="s1">&#39;Dealer Hits&#39;</span>
<span class="lineno">199</span>       <span class="n">hit</span><span class="p">(</span><span class="n">decks</span><span class="p">,</span> <span class="n">dealer</span><span class="p">)</span>
<span class="lineno">200</span>       <span class="nb">sleep</span> <span class="mi">2</span>
<span class="lineno">201</span>       <span class="n">dealer_shows</span><span class="p">(</span><span class="n">dealer</span><span class="p">,</span> <span class="n">player</span><span class="p">,</span> <span class="n">running_total1</span><span class="p">,</span> <span class="n">running_total2</span><span class="p">)</span>
<span class="lineno">202</span>       <span class="n">running_total1</span> <span class="o">=</span> <span class="n">calculate_total</span><span class="p">(</span><span class="n">dealer</span><span class="p">)</span><span class="o">[</span><span class="ss">:total1</span><span class="o">]</span>
<span class="lineno">203</span>       <span class="n">running_total2</span> <span class="o">=</span> <span class="n">calculate_total</span><span class="p">(</span><span class="n">dealer</span><span class="p">)</span><span class="o">[</span><span class="ss">:total2</span><span class="o">]</span> 
<span class="lineno">204</span>       <span class="n">dealer_hit_or_stay</span><span class="p">(</span><span class="n">decks</span><span class="p">,</span> <span class="n">running_total1</span><span class="p">,</span><span class="n">running_total2</span><span class="p">,</span> <span class="n">player</span><span class="p">,</span> <span class="n">dealer</span><span class="p">,</span> <span class="n">player_score</span><span class="p">)</span>
<span class="lineno">205</span>     <span class="k">elsif</span> <span class="n">gamble</span><span class="o">.</span><span class="n">sample</span> <span class="o">==</span> <span class="s1">&#39;no&#39;</span>
<span class="lineno">206</span>       <span class="nb">puts</span> <span class="s1">&#39;Dealer Stays&#39;</span>
<span class="lineno">207</span>       <span class="nb">sleep</span> <span class="mi">2</span>
<span class="lineno">208</span>       <span class="n">running_total1</span> <span class="o">=</span> <span class="n">calculate_total</span><span class="p">(</span><span class="n">dealer</span><span class="p">)</span><span class="o">[</span><span class="ss">:total1</span><span class="o">]</span>
<span class="lineno">209</span>       <span class="n">running_total2</span> <span class="o">=</span> <span class="n">calculate_total</span><span class="p">(</span><span class="n">dealer</span><span class="p">)</span><span class="o">[</span><span class="ss">:total2</span><span class="o">]</span> 
<span class="lineno">210</span>       <span class="n">dealer_score</span> <span class="o">=</span> <span class="n">player_final_score</span><span class="p">(</span><span class="n">running_total1</span><span class="p">,</span> <span class="n">running_total2</span><span class="p">)</span>
<span class="lineno">211</span>       <span class="n">result</span><span class="p">(</span><span class="n">player_score</span><span class="p">,</span> <span class="n">dealer_score</span><span class="p">)</span>
<span class="lineno">212</span>     <span class="k">end</span>
<span class="lineno">213</span>     <span class="c1"># if s result(player_score, dealer_score)</span>
<span class="lineno">214</span>   <span class="k">elsif</span> <span class="n">running_total1</span> <span class="o">&gt;=</span> <span class="mi">19</span> <span class="o">&amp;&amp;</span> <span class="n">running_total1</span> <span class="o">&lt;=</span> <span class="mi">20</span> <span class="o">||</span> <span class="n">running_total2</span> <span class="o">&gt;=</span> <span class="mi">19</span> <span class="o">&amp;&amp;</span> <span class="n">running_total2</span> <span class="o">&lt;=</span> <span class="mi">20</span>
<span class="lineno">215</span>     <span class="nb">puts</span> <span class="s1">&#39;Dealer Stays!&#39;</span>
<span class="lineno">216</span>     <span class="n">running_total1</span> <span class="o">=</span> <span class="n">calculate_total</span><span class="p">(</span><span class="n">dealer</span><span class="p">)</span><span class="o">[</span><span class="ss">:total1</span><span class="o">]</span>
<span class="lineno">217</span>     <span class="n">running_total2</span> <span class="o">=</span> <span class="n">calculate_total</span><span class="p">(</span><span class="n">dealer</span><span class="p">)</span><span class="o">[</span><span class="ss">:total2</span><span class="o">]</span> 
<span class="lineno">218</span>     <span class="n">dealer_score</span> <span class="o">=</span> <span class="n">player_final_score</span><span class="p">(</span><span class="n">running_total1</span><span class="p">,</span> <span class="n">running_total2</span><span class="p">)</span>
<span class="lineno">219</span>     <span class="n">result</span><span class="p">(</span><span class="n">player_score</span><span class="p">,</span> <span class="n">dealer_score</span><span class="p">)</span>
<span class="lineno">220</span>   <span class="k">end</span>
<span class="lineno">221</span> <span class="k">end</span>
<span class="lineno">222</span> 
<span class="lineno">223</span> <span class="c1"># deal new card</span>
<span class="lineno">224</span> <span class="k">def</span> <span class="nf">hit</span><span class="p">(</span><span class="n">deck</span><span class="p">,</span> <span class="n">hand</span><span class="p">)</span>
<span class="lineno">225</span>   <span class="n">hand</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="n">deck</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">deck</span><span class="o">.</span><span class="n">sample</span><span class="p">))</span>
<span class="lineno">226</span>   <span class="n">calculate_total</span><span class="p">(</span><span class="n">hand</span><span class="p">)</span>
<span class="lineno">227</span> <span class="k">end</span>
<span class="lineno">228</span> 
<span class="lineno">229</span> <span class="c1"># result calc</span>
<span class="lineno">230</span> <span class="k">def</span> <span class="nf">result</span><span class="p">(</span><span class="n">player_score</span><span class="p">,</span> <span class="n">dealer_score</span><span class="p">)</span>
<span class="lineno">231</span>   <span class="k">if</span> <span class="n">player_score</span> <span class="o">==</span> <span class="n">dealer_score</span>
<span class="lineno">232</span>     <span class="nb">puts</span> <span class="s2">&quot;Both player got </span><span class="si">#{</span><span class="n">player_score</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="lineno">233</span>     <span class="nb">puts</span> <span class="s2">&quot;It&#39;s a DRAW!&quot;</span>
<span class="lineno">234</span>   <span class="k">elsif</span> <span class="n">player_score</span> <span class="o">&gt;</span> <span class="n">dealer_score</span>
<span class="lineno">235</span>     <span class="nb">puts</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">player_score</span><span class="si">}</span><span class="s2"> beats </span><span class="si">#{</span><span class="n">dealer_score</span><span class="si">}</span><span class="s2">&quot;</span>    
<span class="lineno">236</span>     <span class="nb">puts</span> <span class="s2">&quot;YOU WIN!!!&quot;</span>
<span class="lineno">237</span>   <span class="k">elsif</span> <span class="n">dealer_score</span> <span class="o">&gt;</span> <span class="n">player_score</span>
<span class="lineno">238</span>     <span class="nb">puts</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">dealer_score</span><span class="si">}</span><span class="s2"> beats </span><span class="si">#{</span><span class="n">player_score</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="lineno">239</span>     <span class="nb">puts</span> <span class="s2">&quot;Dealer wins :(&quot;</span>
<span class="lineno">240</span>   <span class="k">end</span>
<span class="lineno">241</span> <span class="k">end</span>
<span class="lineno">242</span> 
<span class="lineno">243</span> 
<span class="lineno">244</span> <span class="c1">#  GGGGG  GGGGG  G   G  GGGGG</span>
<span class="lineno">245</span> <span class="c1">#  G      G   G  GG GG  G</span>
<span class="lineno">246</span> <span class="c1">#  G  GG  GGGGG  G G G  GGG</span>
<span class="lineno">247</span> <span class="c1">#  G   G  G   G  G   G  G</span>
<span class="lineno">248</span> <span class="c1">#  GGGGG  G   G  G   G  GGGGG</span>
<span class="lineno">249</span> 
<span class="lineno">250</span> 
<span class="lineno">251</span> <span class="c1"># play again </span>
<span class="lineno">252</span> <span class="n">play_again</span> <span class="o">=</span> <span class="s1">&#39;y&#39;</span>
<span class="lineno">253</span> <span class="n">game_streak</span> <span class="o">=</span> <span class="mi">0</span>
<span class="lineno">254</span> <span class="n">results</span> <span class="o">=</span> <span class="p">{</span> <span class="ss">:wins</span> <span class="o">=&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="ss">:losses</span> <span class="o">=&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="ss">:draws</span> <span class="o">=&gt;</span> <span class="mi">0</span> <span class="p">}</span> <span class="c1"># store history</span>
<span class="lineno">255</span> 
<span class="lineno">256</span> 
<span class="lineno">257</span> <span class="k">while</span> <span class="n">play_again</span> <span class="o">==</span> <span class="s1">&#39;y&#39;</span>
<span class="lineno">258</span>   <span class="c1"># initialize decks</span>
<span class="lineno">259</span>   <span class="n">decks</span> <span class="o">=</span> <span class="o">[</span><span class="s1">&#39;Ah &#39;</span><span class="p">,</span> <span class="s1">&#39;2h &#39;</span><span class="p">,</span> <span class="s1">&#39;3h &#39;</span><span class="p">,</span> <span class="s1">&#39;4h &#39;</span><span class="p">,</span> <span class="s1">&#39;5h &#39;</span><span class="p">,</span> <span class="s1">&#39;6h &#39;</span><span class="p">,</span> <span class="s1">&#39;7h &#39;</span><span class="p">,</span> <span class="s1">&#39;8h &#39;</span><span class="p">,</span> <span class="s1">&#39;9h &#39;</span><span class="p">,</span> <span class="s1">&#39;10h&#39;</span><span class="p">,</span> <span class="s1">&#39;Jh &#39;</span><span class="p">,</span> <span class="s1">&#39;Qh &#39;</span><span class="p">,</span> <span class="s1">&#39;Kh &#39;</span><span class="p">,</span><span class="s1">&#39;Ad &#39;</span><span class="p">,</span> <span class="s1">&#39;2d &#39;</span><span class="p">,</span> <span class="s1">&#39;3d &#39;</span><span class="p">,</span> <span class="s1">&#39;4d &#39;</span><span class="p">,</span> <span class="s1">&#39;5d &#39;</span><span class="p">,</span> <span class="s1">&#39;6d &#39;</span><span class="p">,</span> <span class="s1">&#39;7d &#39;</span><span class="p">,</span> <span class="s1">&#39;8d &#39;</span><span class="p">,</span> <span class="s1">&#39;9d &#39;</span><span class="p">,</span> <span class="s1">&#39;10d&#39;</span><span class="p">,</span> <span class="s1">&#39;Jd &#39;</span><span class="p">,</span> <span class="s1">&#39;Qd &#39;</span><span class="p">,</span> <span class="s1">&#39;Kd &#39;</span><span class="p">,</span> <span class="s1">&#39;As &#39;</span><span class="p">,</span> <span class="s1">&#39;2s &#39;</span><span class="p">,</span> <span class="s1">&#39;3s &#39;</span><span class="p">,</span> <span class="s1">&#39;4s &#39;</span><span class="p">,</span> <span class="s1">&#39;5s &#39;</span><span class="p">,</span> <span class="s1">&#39;6s &#39;</span><span class="p">,</span> <span class="s1">&#39;7s &#39;</span><span class="p">,</span> <span class="s1">&#39;8s &#39;</span><span class="p">,</span> <span class="s1">&#39;9s &#39;</span><span class="p">,</span> <span class="s1">&#39;10s&#39;</span><span class="p">,</span> <span class="s1">&#39;Js &#39;</span><span class="p">,</span> <span class="s1">&#39;Qs &#39;</span><span class="p">,</span> <span class="s1">&#39;Ks &#39;</span><span class="p">,</span> <span class="s1">&#39;Ac &#39;</span><span class="p">,</span> <span class="s1">&#39;2c &#39;</span><span class="p">,</span> <span class="s1">&#39;3c &#39;</span><span class="p">,</span> <span class="s1">&#39;4c &#39;</span><span class="p">,</span> <span class="s1">&#39;5c &#39;</span><span class="p">,</span> <span class="s1">&#39;6c &#39;</span><span class="p">,</span> <span class="s1">&#39;7c &#39;</span><span class="p">,</span> <span class="s1">&#39;8c &#39;</span><span class="p">,</span> <span class="s1">&#39;9c &#39;</span><span class="p">,</span> <span class="s1">&#39;10c&#39;</span><span class="p">,</span> <span class="s1">&#39;Jc &#39;</span><span class="p">,</span> <span class="s1">&#39;Qc &#39;</span><span class="p">,</span> <span class="s1">&#39;Kc &#39;</span><span class="p">,</span> <span class="s1">&#39;Ah &#39;</span><span class="p">,</span> <span class="s1">&#39;2h &#39;</span><span class="p">,</span> <span class="s1">&#39;3h &#39;</span><span class="p">,</span> <span class="s1">&#39;4h &#39;</span><span class="p">,</span> <span class="s1">&#39;5h &#39;</span><span class="p">,</span> <span class="s1">&#39;6h &#39;</span><span class="p">,</span> <span class="s1">&#39;7h &#39;</span><span class="p">,</span> <span class="s1">&#39;8h &#39;</span><span class="p">,</span> <span class="s1">&#39;9h &#39;</span><span class="p">,</span> <span class="s1">&#39;10h&#39;</span><span class="p">,</span> <span class="s1">&#39;Jh &#39;</span><span class="p">,</span> <span class="s1">&#39;Qh &#39;</span><span class="p">,</span> <span class="s1">&#39;Kh &#39;</span><span class="p">,</span><span class="s1">&#39;Ad &#39;</span><span class="p">,</span> <span class="s1">&#39;2d &#39;</span><span class="p">,</span> <span class="s1">&#39;3d &#39;</span><span class="p">,</span> <span class="s1">&#39;4d &#39;</span><span class="p">,</span> <span class="s1">&#39;5d &#39;</span><span class="p">,</span> <span class="s1">&#39;6d &#39;</span><span class="p">,</span> <span class="s1">&#39;7d &#39;</span><span class="p">,</span> <span class="s1">&#39;8d &#39;</span><span class="p">,</span> <span class="s1">&#39;9d &#39;</span><span class="p">,</span> <span class="s1">&#39;10d&#39;</span><span class="p">,</span> <span class="s1">&#39;Jd &#39;</span><span class="p">,</span> <span class="s1">&#39;Qd &#39;</span><span class="p">,</span> <span class="s1">&#39;Kd &#39;</span><span class="p">,</span> <span class="s1">&#39;As &#39;</span><span class="p">,</span> <span class="s1">&#39;2s &#39;</span><span class="p">,</span> <span class="s1">&#39;3s &#39;</span><span class="p">,</span> <span class="s1">&#39;4s &#39;</span><span class="p">,</span> <span class="s1">&#39;5s &#39;</span><span class="p">,</span> <span class="s1">&#39;6s &#39;</span><span class="p">,</span> <span class="s1">&#39;7s &#39;</span><span class="p">,</span> <span class="s1">&#39;8s &#39;</span><span class="p">,</span> <span class="s1">&#39;9s &#39;</span><span class="p">,</span> <span class="s1">&#39;10s&#39;</span><span class="p">,</span> <span class="s1">&#39;Js &#39;</span><span class="p">,</span> <span class="s1">&#39;Qs &#39;</span><span class="p">,</span> <span class="s1">&#39;Ks &#39;</span><span class="p">,</span> <span class="s1">&#39;Ac &#39;</span><span class="p">,</span> <span class="s1">&#39;2c &#39;</span><span class="p">,</span> <span class="s1">&#39;3c &#39;</span><span class="p">,</span> <span class="s1">&#39;4c &#39;</span><span class="p">,</span> <span class="s1">&#39;5c &#39;</span><span class="p">,</span> <span class="s1">&#39;6c &#39;</span><span class="p">,</span> <span class="s1">&#39;7c &#39;</span><span class="p">,</span> <span class="s1">&#39;8c &#39;</span><span class="p">,</span> <span class="s1">&#39;9c &#39;</span><span class="p">,</span> <span class="s1">&#39;10c&#39;</span><span class="p">,</span> <span class="s1">&#39;Jc &#39;</span><span class="p">,</span> <span class="s1">&#39;Qc &#39;</span><span class="p">,</span> <span class="s1">&#39;Kc &#39;</span><span class="o">]</span>
<span class="lineno">260</span>   
<span class="lineno">261</span>   <span class="c1"># empty arrays to hold all players cards</span>
<span class="lineno">262</span>   <span class="n">player</span> <span class="o">=</span> <span class="o">[]</span>
<span class="lineno">263</span>   <span class="n">dealer</span> <span class="o">=</span> <span class="o">[]</span>   
<span class="lineno">264</span> 
<span class="lineno">265</span>   <span class="c1"># Deal two card to each player</span>
<span class="lineno">266</span>   <span class="n">deal</span><span class="p">(</span><span class="n">player</span><span class="p">,</span> <span class="n">dealer</span><span class="p">,</span> <span class="n">decks</span><span class="p">)</span>
<span class="lineno">267</span> 
<span class="lineno">268</span>   <span class="c1"># player takes turn</span>
<span class="lineno">269</span>   <span class="n">total1</span> <span class="o">=</span> <span class="n">calculate_total</span><span class="p">(</span><span class="n">player</span><span class="p">)</span><span class="o">[</span><span class="ss">:total1</span><span class="o">]</span> 
<span class="lineno">270</span>   <span class="n">total2</span> <span class="o">=</span> <span class="n">calculate_total</span><span class="p">(</span><span class="n">player</span><span class="p">)</span><span class="o">[</span><span class="ss">:total2</span><span class="o">]</span> 
<span class="lineno">271</span>   <span class="n">player_hit_or_stay</span><span class="p">(</span><span class="n">total1</span><span class="p">,</span><span class="n">total2</span><span class="p">,</span> <span class="n">decks</span><span class="p">,</span> <span class="n">player</span><span class="p">,</span> <span class="n">dealer</span><span class="p">)</span>
<span class="lineno">272</span>   <span class="n">total1</span> <span class="o">=</span> <span class="n">calculate_total</span><span class="p">(</span><span class="n">player</span><span class="p">)</span><span class="o">[</span><span class="ss">:total1</span><span class="o">]</span> 
<span class="lineno">273</span>   <span class="n">total2</span> <span class="o">=</span> <span class="n">calculate_total</span><span class="p">(</span><span class="n">player</span><span class="p">)</span><span class="o">[</span><span class="ss">:total2</span><span class="o">]</span> 
<span class="lineno">274</span>   <span class="nb">p</span> <span class="o">=</span> <span class="n">player_final_score</span><span class="p">(</span><span class="n">total1</span><span class="p">,</span> <span class="n">total2</span><span class="p">)</span>
<span class="lineno">275</span>   <span class="n">total1</span> <span class="o">=</span> <span class="n">calculate_total</span><span class="p">(</span><span class="n">dealer</span><span class="p">)</span><span class="o">[</span><span class="ss">:total1</span><span class="o">]</span> 
<span class="lineno">276</span>   <span class="n">total2</span> <span class="o">=</span> <span class="n">calculate_total</span><span class="p">(</span><span class="n">dealer</span><span class="p">)</span><span class="o">[</span><span class="ss">:total2</span><span class="o">]</span> 
<span class="lineno">277</span>   <span class="n">d</span> <span class="o">=</span> <span class="n">player_final_score</span><span class="p">(</span><span class="n">total1</span><span class="p">,</span> <span class="n">total2</span><span class="p">)</span>
<span class="lineno">278</span> 
<span class="lineno">279</span> 
<span class="lineno">280</span>   <span class="nb">sleep</span> <span class="mi">0</span><span class="o">.</span><span class="mi">5</span>
<span class="lineno">281</span>  
<span class="lineno">282</span>   <span class="k">if</span> <span class="n">d</span> <span class="o">&gt;</span> <span class="mi">21</span>
<span class="lineno">283</span>     <span class="n">results</span><span class="o">[</span><span class="ss">:wins</span><span class="o">]</span> <span class="o">=</span> <span class="n">results</span><span class="o">[</span><span class="ss">:wins</span><span class="o">]</span> <span class="o">+</span> <span class="mi">1</span>
<span class="lineno">284</span>   <span class="k">elsif</span> <span class="nb">p</span> <span class="o">&lt;=</span> <span class="mi">21</span> <span class="o">&amp;&amp;</span> <span class="nb">p</span> <span class="o">&gt;</span> <span class="n">d</span>
<span class="lineno">285</span>     <span class="n">results</span><span class="o">[</span><span class="ss">:wins</span><span class="o">]</span> <span class="o">=</span> <span class="n">results</span><span class="o">[</span><span class="ss">:wins</span><span class="o">]</span> <span class="o">+</span> <span class="mi">1</span>
<span class="lineno">286</span>   <span class="k">elsif</span> <span class="nb">p</span> <span class="o">==</span> <span class="n">d</span>
<span class="lineno">287</span>     <span class="n">results</span><span class="o">[</span><span class="ss">:draws</span><span class="o">]</span> <span class="o">=</span> <span class="n">results</span><span class="o">[</span><span class="ss">:draws</span><span class="o">]</span> <span class="o">+</span> <span class="mi">1</span>
<span class="lineno">288</span>   <span class="k">elsif</span> <span class="n">d</span> <span class="o">&lt;=</span> <span class="mi">21</span> <span class="o">&amp;&amp;</span> <span class="n">d</span> <span class="o">&gt;</span> <span class="nb">p</span>
<span class="lineno">289</span>     <span class="n">results</span><span class="o">[</span><span class="ss">:losses</span><span class="o">]</span> <span class="o">=</span> <span class="n">results</span><span class="o">[</span><span class="ss">:losses</span><span class="o">]</span> <span class="o">+</span> <span class="mi">1</span>
<span class="lineno">290</span>   <span class="k">elsif</span> <span class="nb">p</span> <span class="o">&gt;</span> <span class="mi">21</span>
<span class="lineno">291</span>     <span class="n">results</span><span class="o">[</span><span class="ss">:losses</span><span class="o">]</span> <span class="o">=</span> <span class="n">results</span><span class="o">[</span><span class="ss">:losses</span><span class="o">]</span> <span class="o">+</span> <span class="mi">1</span>
<span class="lineno">292</span>   <span class="k">end</span>
<span class="lineno">293</span>     
<span class="lineno">294</span>   <span class="n">game_streak</span> <span class="o">=</span> <span class="n">game_streak</span> <span class="o">+</span> <span class="mi">1</span>
<span class="lineno">295</span>   <span class="n">per_wins</span> <span class="o">=</span> <span class="p">(</span><span class="n">results</span><span class="o">[</span><span class="ss">:wins</span><span class="o">].</span><span class="n">to_f</span> <span class="o">/</span> <span class="n">game_streak</span><span class="o">.</span><span class="n">to_f</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="lineno">296</span>   <span class="nb">puts</span> <span class="s2">&quot;_____________________________________&quot;</span>
<span class="lineno">297</span>   <span class="nb">puts</span> <span class="s2">&quot;_____________________________________&quot;</span>
<span class="lineno">298</span>   <span class="nb">puts</span> <span class="s2">&quot;Current game streak is </span><span class="si">#{</span><span class="n">game_streak</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="lineno">299</span>   <span class="nb">puts</span> <span class="s2">&quot;You have won </span><span class="si">#{</span><span class="n">results</span><span class="o">[</span><span class="ss">:wins</span><span class="o">]</span><span class="si">}</span><span class="s2">, lost </span><span class="si">#{</span><span class="n">results</span><span class="o">[</span><span class="ss">:losses</span><span class="o">]</span><span class="si">}</span><span class="s2"> and drawn </span><span class="si">#{</span><span class="n">results</span><span class="o">[</span><span class="ss">:draws</span><span class="o">]</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="lineno">300</span>   <span class="nb">puts</span> <span class="s2">&quot;You have won </span><span class="si">#{</span><span class="n">per_wins</span><span class="si">}</span><span class="s2">% of the games you have played&quot;</span>
<span class="lineno">301</span>   <span class="nb">puts</span> <span class="s2">&quot;_____________________________________&quot;</span>
<span class="lineno">302</span>   <span class="nb">puts</span> <span class="s2">&quot;_____________________________________&quot;</span>
<span class="lineno">303</span> 
<span class="lineno">304</span>   <span class="c1"># play again?</span>
<span class="lineno">305</span>   <span class="nb">puts</span> <span class="s2">&quot;Play again? (y/n)&quot;</span>
<span class="lineno">306</span>   <span class="n">play_again</span> <span class="o">=</span> <span class="nb">gets</span><span class="o">.</span><span class="n">chomp</span>
<span class="lineno">307</span> 
<span class="lineno">308</span> <span class="k">end</span></code></pre></div>

<p>I built in some pretty neat features too like making the dealer not follow a scripted method of hit or staying. I also allowed Ace to be worth 1 and 11 and giving the player an option to play both totals. Finally whilst in the game loop the game stores your game streak, wins, losses and draws total and outputs the percentage of wins you have.</p>

