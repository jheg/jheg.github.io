<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>The structure of a Rails app. Part 1</title>
    <meta name="viewport" content="width=device-width">
    <meta name="description" content="Documenting my path to learning the ruby language and ruby on rails from absolute beginner. ">
    <link rel="canonical" href="http://jheg.co.uk/rails/2015/01/08/rails/">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/main.css">
    <link rel="stylesheet" href="/style.css">
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-57731704-1', 'auto');
      ga('send', 'pageview');

    </script>
</head>


    <body>

    <header class="site-header">

  <div class="wrap">

    <a class="site-title" href="/">Jason Hegarty learning to code in ruby</a>

    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
           viewBox="0 0 18 15" enable-background="new 0 0 18 15" xml:space="preserve">
          <path fill="#505050" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0
            h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#505050" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484
            h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#505050" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0
            c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>
      <div class="trigger">
        
          <a class="page-link" href="/about/">About</a>
        
          <a class="page-link" href="/feed.xml"></a>
        
          <a class="page-link" href="/"></a>
        
      </div>
    </nav>

  </div>

</header>


    <div class="page-content">
      <div class="wrap">
      <div class="post">

  <header class="post-header">
    <h1>The structure of a Rails app. Part 1</h1>
    <p class="meta">Jan 8, 2015</p>
  </header>

  <article class="post-content">
  <p><span class="terminal">$ cd dev</span><br />
<span class="terminal">$dev rails new got_to_do_app</span></p>

<h2>Step 1 - What my app will do</h2>

<p>The plan is to build an app that simply allows users to write a todo list. There are many features I intend to implement but initially I will just get a basic version up and running and then later add further functionality to it. This will be my test app - my Rails playground.</p>

<p>The initial feature set will allow a user to:</p>
<ul>
  <li>Register and Log in<br />A User will comprise a name, email and mobile number</li>
  <li>Add a ToDo task<br />A ToDo task will include a title, description, deadline and timestamps of creation date and updated date</li>
  <li>Comment on Todo items <br />A Comment will include a comment</li>
  <li>Assign categories to Todo items<br />A category will include a name</li>
</ul>

<p>Future iterations will include the ability to:</p>
<ul>
  <li>Add someone to a Todo item</li>
  <li>Send email and possibly sms notifications</li>
</ul>

<h2>Step 2 - Building out the database and associations</h2>
<p>Rails apps work on a Model, View, Controller principle or MVC for short. This breaks down the tasks of the apllication into three parts each with their own job. The View renders and sends a completed webpage from the server to the user once it has gathered all the information it needs from the database, via the Model, which they get from the Controller. It’s easy to visualize with the diagram below.</p>

<p><img src="/assets/model_view_controller_in_rails.png" width="300" alt="picture of the model view controller workflow in Rails" /></p>

<p>For this post we are focusing on the Model and the Database and we’ll leave controllers and views until a later post.</p>

<p>Before creating the tables in a database to contain the data we need, we need to visualize what we want to store and how our data relates to each other. </p>

<p>You can do this on a peice of paper just to sketch out the idea. </p>

<p><img src="/assets/rails_app_simple_entity_relationship_diagram.png" width="500" alt="picture of an entity relationship diagram for a small rails app" /></p>

<p>The elements of the app have been split into 4 tables plus a join table ( I’ll explain the join table shortly ). This diagram helps us with four tasks when building our database tables and building the relationships between each table in the database. </p>

<ol>
  <li>The boxes represent each table in our database</li>
  <li>The columns in a table are the elements within each box ( id, name, created_at… )</li>
  <li>The lines that connect the boxes show relationships ( Associations )</li>
  <li>Establishes where we need foreign keys</li>
</ol>

<h4>Foreign Keys</h4>
<p>We need two things to make an association, one at the database layer and the other in the model layer. Lets suppose we have created a User called Charlie. Charlie creates a todo item with a title of ‘Do the shopping on way home’ and another one with the title ‘Remember to clean my room’. Already we can see that whilst Charlie ( User ) can have many Todo items a Todo item can only have and belong to one User. In order to create this behaviour in the database we must include what is called a ‘foreign key’ in the table that is on the one side of the agreement - the todos table. </p>

<p>The foreign key MUST be named correctly in order for the link to work. It must start with the singular version of the table name followed by an underscore and id like so: user_id ( shown in the diagram above ). Rails will assume that there is a table named users with a column name of id and this will provide the first part of the link.</p>

<p>To summarise:</p>
<ul>
<li>A User has many todos and has many comments</li>
<li>A Todo belongs to a User and has many comments and has many categories</li>
<li>A Comment belongs to a User and belongs to a Todo</li>
<li>A Category has many todos</li>
</ul>

<p>We can pretty much cover all of these points the same way that we did the User-Todo relationship using the foreign key but there is one relationship that doesn’t follow the one to many (1:M) pattern. A Todo can have many categories and a Category can have many todos. This is called a many to many (M:M) association and requires a <em>join table</em> to deal with this type of relationship. </p>

<p>A join table here does the job of connecting the todos table and the categories table. The foreign keys reside in the join table and create a 1:M association from the join table to both the todos table and the categories table. </p>

<p>In part 2 we will build the tables and the models.</p>

<!-- <h4>Creating tables with migration files</h4>
<span class="terminal">$ rails generate migration create_users.rb</span>





The second part of the link happens when we create the object model. 






ALL IS NOT LOST:
If you accidently forgot to add a column you can simply create a new migration. I forgot to add an sms column to users so ...
 -->


  </article>

</div>
      </div>
    </div>
    
        <div id="disqus_thread" class="wrap"></div>
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'jheg'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    
    
    <footer class="site-footer">
  <div class="wrap">

    <h2 class="footer-heading">Jason Hegarty learning to code in ruby</h2>
    <div class="profile_pic"><img src="/assets/me.png"></div>

    <div class="footer-col-1 column">
      <ul>
        <li>Jason Hegarty learning to code in ruby</li>
        <li><a href="mailto:jason@jheg.co.uk">jason@jheg.co.uk</a></li>
      </ul>
    </div>

    <div class="footer-col-2 column">
      <ul>
        <li>
          <a href="https://github.com/jheg">
            <span class="icon github">
              <svg version="1.1" class="github-icon-svg" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
                 viewBox="0 0 16 16" enable-background="new 0 0 16 16" xml:space="preserve">
                <path fill-rule="evenodd" clip-rule="evenodd" fill="#C2C2C2" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761
                c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32
                c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472
                c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037
                C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65
                c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261
                c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082
                c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129
                c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/>
              </svg>
            </span>
            <span class="username"></span>
          </a>
        </li>
        <li>
          <a href="https://twitter.com/jheg_">
            <span class="icon twitter">
              <svg version="1.1" class="twitter-icon-svg" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
                 viewBox="0 0 16 16" enable-background="new 0 0 16 16" xml:space="preserve">
                <path fill="#C2C2C2" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809
                c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27
                c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767
                c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206
                C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271
                c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469
                c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/>
              </svg>
            </span>
            <span class="username"></span>
          </a>
        </li>
      </ul>
    </div>

    <div class="footer-col-3 column">
      <p class="text">Documenting my path to learning the ruby language and ruby on rails from absolute beginner. </p>
    </div>

  </div>

</footer>

    <script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'jheg'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
    </script>
    </body>
</html>